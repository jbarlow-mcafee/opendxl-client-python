
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>McAfee Active Response (MAR) Search Sample &#8212; OpenDXL Python SDK 4.1.0.187 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Authorize Client to Perform MAR Search" href="marsendauth.html" />
    <link rel="prev" title="Threat Intelligence Exchange (TIE) File Reputation Sample" href="tiefilerepexample.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="marsendauth.html" title="Authorize Client to Perform MAR Search"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tiefilerepexample.html" title="Threat Intelligence Exchange (TIE) File Reputation Sample"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenDXL Python SDK 4.1.0.187 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="mcafee-active-response-mar-search-sample">
<h1>McAfee Active Response (MAR) Search Sample<a class="headerlink" href="#mcafee-active-response-mar-search-sample" title="Permalink to this headline">¶</a></h1>
<p>This sample queries McAfee Active Response for the IP addresses of hosts that have an <code class="docutils literal notranslate"><span class="pre">Active</span> <span class="pre">Response</span></code> client
installed.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The samples configuration step has been completed (<a class="reference internal" href="sampleconfig.html"><span class="doc">Samples Configuration</span></a>)</li>
<li>A McAfee Active Response (MAR) Service is available on the DXL fabric</li>
<li>The python client has been authorized to perform MAR searches (see <a class="reference internal" href="marsendauth.html"><span class="doc">Authorize Client to Perform MAR Search</span></a>)</li>
</ul>
<p>To run this sample execute the <code class="docutils literal notranslate"><span class="pre">sample\mar\search_example.py</span></code> script as follows:</p>
<blockquote>
<div><pre class="literal-block">
c:\dxlclient-python-sdk-4.1.0.187&gt;python sample\mar\search_example.py
</pre>
</div></blockquote>
<p>To perform an Active Response query via DXL the following steps must be performed:</p>
<ul class="simple">
<li>Create a MAR search by sending a search query (via a <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> message) to the MAR service</li>
<li>Extract the search identifier from the <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Response" title="dxlclient.message.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Response</span></code></a> message received in response to the query creation request</li>
<li>Start the search by sending an appropriate <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> message to the MAR service</li>
<li>Poll the MAR service for the status of the search by sending <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> messages to obtain the search status (via <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Response" title="dxlclient.message.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Response</span></code></a> messages)</li>
<li>Once the search has completed, query the MAR service for the results of the search (via a <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> message)</li>
<li>Process the results of the search query in the <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Response" title="dxlclient.message.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Response</span></code></a> message received corresponding to the results request</li>
</ul>
<p>All of the MAR query-related <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> messages described in the steps above are sent to the same DXL topic (<code class="docutils literal notranslate"><span class="pre">/mcafee/mar/service/api/search</span></code>).</p>
<p>Each of these steps are performed in the sample script and will be described in detail throughout the rest of this
document. All of the steps utilize a local convenience method within the script (<code class="docutils literal notranslate"><span class="pre">execute_mar_search_api()</span></code>).
This method is responsible for hiding the details of converting Python <code class="docutils literal notranslate"><span class="pre">dictionary</span></code> objects to DXL request objects
and extracting dictionaries from DXL response objects. The method also hides the details of sending synchronous
requests to the MAR service and handling any errors that may occur. The <code class="docutils literal notranslate"><span class="pre">execute_mar_search_api()</span></code> method is
described in detail at the bottom of this document.</p>
<p>The first step is to create a MAR query as shown below. In this particular case the query will be for the IP
addresses (<code class="docutils literal notranslate"><span class="pre">ip_address</span></code>) of any hosts (<code class="docutils literal notranslate"><span class="pre">HostInfo</span></code>) that have an Active Response client installed.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the search</span>
<span class="n">response_dict</span> <span class="o">=</span> <span class="n">execute_mar_search_api</span><span class="p">(</span>
    <span class="n">client</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/simple&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;aggregated&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;HostInfo&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ip_address&quot;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>As shown below, the code block above results in a <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> message being sent to the
MAR service containing the query that is to be created. The <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Response" title="dxlclient.message.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Response</span></code></a> message from the MAR
service includes meta-information about the search that was created, including a status code (<code class="docutils literal notranslate"><span class="pre">code</span></code>) with a
value of 201 (<code class="docutils literal notranslate"><span class="pre">created</span></code>) indicating that the creation was successful along with the identifier (<code class="docutils literal notranslate"><span class="pre">id</span></code>) of the
search (this identifier will be used in subsequent steps).</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;aggregated&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;HostInfo&quot;</span><span class="p">,</span>
                <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;ip_address&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/simple&quot;</span>
<span class="p">}</span>

<span class="n">Response</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;aggregated&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;catalogVersion&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;createdAt&quot;</span><span class="p">:</span> <span class="mi">1474308184842</span><span class="p">,</span>
        <span class="s2">&quot;dbVersion&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;expectedHostResponses&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;57e02858e4b0217da8f65e80&quot;</span><span class="p">,</span>
        <span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="o">...</span> <span class="p">],</span>
        <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;CREATED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;temporal&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;ttl&quot;</span><span class="p">:</span> <span class="mi">60000</span>
    <span class="p">},</span>
    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">201</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>The next step (as shown below) extracts the identifier (<code class="docutils literal notranslate"><span class="pre">id</span></code>) of the newly created search from the response
dictionary. This identifier is included in the next request that is sent to the MAR service requesting that
the search be started.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the search identifier</span>
<span class="n">search_id</span> <span class="o">=</span> <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

<span class="c1"># Start the search</span>
<span class="n">execute_mar_search_api</span><span class="p">(</span>
    <span class="n">client</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/&quot;</span> <span class="o">+</span> <span class="n">search_id</span> <span class="o">+</span> <span class="s2">&quot;/start&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>As shown below, the code block above results in a <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> message being sent to the
MAR service requesting that the search be started. The <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Response" title="dxlclient.message.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Response</span></code></a> message from the MAR
service includes a status code (<code class="docutils literal notranslate"><span class="pre">code</span></code>) with a value of 200 (<code class="docutils literal notranslate"><span class="pre">OK</span></code>) indicating that the search has been started.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/57e02858e4b0217da8f65e80/start&quot;</span>
<span class="p">}</span>

<span class="n">Response</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;aggregated&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;catalogVersion&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;createdAt&quot;</span><span class="p">:</span> <span class="mi">1474308184842</span><span class="p">,</span>
        <span class="s2">&quot;dbVersion&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;executedAt&quot;</span><span class="p">:</span> <span class="mi">1474308184964</span><span class="p">,</span>
        <span class="s2">&quot;expectedHostResponses&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;57e02858e4b0217da8f65e80&quot;</span><span class="p">,</span>
        <span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="o">...</span> <span class="p">],</span>
        <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="mi">1474308184964</span><span class="p">,</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;STARTED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;temporal&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;ttl&quot;</span><span class="p">:</span> <span class="mi">60000</span>
    <span class="p">},</span>
    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">200</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>The next step (as shown below) will poll the MAR service for the status of the executed search until it has reached a
status of <code class="docutils literal notranslate"><span class="pre">FINISHED</span></code>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Wait until the search finishes</span>
<span class="n">finished</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">finished</span><span class="p">:</span>
    <span class="n">response_dict</span> <span class="o">=</span> <span class="n">execute_mar_search_api</span><span class="p">(</span>
        <span class="n">client</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/&quot;</span> <span class="o">+</span> <span class="n">search_id</span> <span class="o">+</span> <span class="s2">&quot;/status&quot;</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="n">response_dict</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;FINISHED&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">finished</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>As shown below, the code block above results in one or more <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> messages being sent to
the MAR service requesting the status of the search. Each <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Response" title="dxlclient.message.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Response</span></code></a> message from the MAR
service includes the current status (<code class="docutils literal notranslate"><span class="pre">status</span></code>) of the search (<code class="docutils literal notranslate"><span class="pre">STARTED</span></code>, <code class="docutils literal notranslate"><span class="pre">FINISHED</span></code>, etc.).</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/57e02858e4b0217da8f65e80/status&quot;</span>
<span class="p">}</span>

<span class="n">Response</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;hosts&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;STARTED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subscribedHosts&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">},</span>
    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">200</span>
<span class="p">}</span>

<span class="n">Request</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/57e02858e4b0217da8f65e80/status&quot;</span>
<span class="p">}</span>

<span class="n">Response</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;hosts&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;FINISHED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subscribedHosts&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">200</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>Once the search has completed, the next step is to obtain the results of the search from the MAR service (as shown
in the code block below). In this particular case, the search results are being limited (<code class="docutils literal notranslate"><span class="pre">$limit</span></code>) to 10 results.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the search results</span>
<span class="c1"># Results limited to 10, the API does support paging</span>
<span class="n">response_dict</span> <span class="o">=</span> <span class="n">execute_mar_search_api</span><span class="p">(</span>
    <span class="n">client</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/&quot;</span> <span class="o">+</span> <span class="n">search_id</span> <span class="o">+</span> <span class="s2">&quot;/results&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;$offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;$limit&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sortBy&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sortDirection&quot;</span><span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>As shown below, the code block above sends a <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> message to the MAR service
indicating how results are to be received (filtered, sorted, limited, etc.). The corresponding
<a class="reference internal" href="dxlclient.message.html#dxlclient.message.Response" title="dxlclient.message.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Response</span></code></a> message includes the search results (<code class="docutils literal notranslate"><span class="pre">items</span></code>) along with meta-information
about the results (counts, paging-related information, etc.).</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;$limit&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;$offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sortBy&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sortDirection&quot;</span><span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/57e02858e4b0217da8f65e80/results&quot;</span>
<span class="p">}</span>

<span class="n">Response</span><span class="p">:</span>

<span class="p">{</span>
    <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;currentItemCount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-19T18:03:07.722Z&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;{1=[10.84.200.99]}&quot;</span><span class="p">,</span>
                <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;HostInfo|ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.84.200.99&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;itemsPerPage&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;startIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;totalItems&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">200</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>The final code block in the script extracts the IP addresses from the search results (as shown below).</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop and display the results</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Results:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">response_dict</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="s1">&#39;items&#39;</span><span class="p">]:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="s1">&#39;HostInfo|ip_address&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
<p>The output should appear similar to the following:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Results</span><span class="p">:</span>
    <span class="mf">10.84</span><span class="o">.</span><span class="mf">200.99</span>
</pre></div>
</div>
</div></blockquote>
<p>The major functionality provided by this sample resides in the <code class="docutils literal notranslate"><span class="pre">execute_mar_search_api()</span></code> method as shown
below:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">execute_mar_search_api</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">payload_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a query against the MAR search api</span>

<span class="sd">    :param client: The DXL client</span>
<span class="sd">    :param payload_dict: The payload</span>
<span class="sd">    :return: A dictionary containing the results of the query</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the request message</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">CREATE_SEARCH_TOPIC</span><span class="p">)</span>
    <span class="c1"># Set the payload</span>
    <span class="n">req</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload_dict</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>

    <span class="c1"># Display the request that is going to be sent</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Request:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload_dict</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>

    <span class="c1"># Send the request and wait for a response (synchronous)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">sync_request</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="c1"># Return a dictionary corresponding to the response payload</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">message_type</span> <span class="o">!=</span> <span class="n">Message</span><span class="o">.</span><span class="n">MESSAGE_TYPE_ERROR</span><span class="p">:</span>
        <span class="n">resp_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">))</span>
        <span class="c1"># Display the response</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Response:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">resp_dict</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                         <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="s2">&quot;code&quot;</span> <span class="ow">in</span> <span class="n">resp_dict</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">resp_dict</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">code</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="ow">or</span> <span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;body&quot;</span> <span class="ow">in</span> <span class="n">resp_dict</span> <span class="ow">and</span> <span class="s2">&quot;applicationErrorList&quot;</span> <span class="ow">in</span> <span class="n">resp_dict</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">resp_dict</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">][</span><span class="s2">&quot;applicationErrorList&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="s2">&quot;body&quot;</span> <span class="ow">in</span> <span class="n">resp_dict</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">resp_dict</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error: Received failure response code: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error: unable to find response code&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp_dict</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="o">.</span><span class="n">error_message</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">error_code</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>This method creates a <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Request" title="dxlclient.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Request</span></code></a> message that will be delivered to the
search topic (<code class="docutils literal notranslate"><span class="pre">/mcafee/mar/service/api/search</span></code>) of a MAR service on the fabric. Prior to delivering the request,
the dictionary specified as a method parameter (<code class="docutils literal notranslate"><span class="pre">payload_dict</span></code>) is converted to a JSON string and
placed in the payload of the request message.</p>
<p>The request message is delivered to the fabric via the <a class="reference internal" href="dxlclient.client.html#dxlclient.client.DxlClient.sync_request" title="dxlclient.client.DxlClient.sync_request"><code class="xref py py-func docutils literal notranslate"><span class="pre">dxlclient.client.DxlClient.sync_request()</span></code></a> method on
the DXL client.</p>
<p>The payload of the <a class="reference internal" href="dxlclient.message.html#dxlclient.message.Response" title="dxlclient.message.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">dxlclient.message.Response</span></code></a> message received is converted to a Python <code class="docutils literal notranslate"><span class="pre">dictionary</span></code>
object. The status code (<code class="docutils literal notranslate"><span class="pre">code</span></code>) within the dictionary is examined to ensure that the request was successful.
If the request was successful, the dictionary extracted from the response is returned to the caller of the method.
The method will raise exceptions for any errors that occur during the request itself or during validation.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">McAfee Active Response (MAR) Search Sample</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tiefilerepexample.html"
                        title="previous chapter">Threat Intelligence Exchange (TIE) File Reputation Sample</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="marsendauth.html"
                        title="next chapter">Authorize Client to Perform MAR Search</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/marsearchexample.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="marsendauth.html" title="Authorize Client to Perform MAR Search"
             >next</a> |</li>
        <li class="right" >
          <a href="tiefilerepexample.html" title="Threat Intelligence Exchange (TIE) File Reputation Sample"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenDXL Python SDK 4.1.0.187 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, McAfee LLC.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>